/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var d=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var F=(i,r)=>{for(var e in r)d(i,e,{get:r[e],enumerable:!0})},L=(i,r,e,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of x(r))!I.call(i,s)&&s!==e&&d(i,s,{get:()=>r[s],enumerable:!(t=D(r,s))||t.enumerable});return i};var P=i=>L(d({},"__esModule",{value:!0}),i);var M={};F(M,{default:()=>h});module.exports=P(M);var m=require("obsidian");var o=require("obsidian"),l={blinkSpeed:1.2,blinkDelay:0,movementTime:80,cursorWidth:1,cursorColor:"#ffffff"},a=class extends o.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){var f,v,S,y,b;let{containerEl:e}=this;e.empty();let t=new o.Setting(this.containerEl).setName("Cursor colour").setDesc("The colour of the cursor icon. Defaults to (dark-mode dependent) black or white.");new u(t.controlEl).onClick(async()=>{s.setValue("#ffffff"),this.plugin.settings.cursorColor=null,this.plugin.changeCursorColour(),await this.plugin.saveSettings()});let s=new o.ColorComponent(t.controlEl).setValue((f=this.plugin.settings.cursorColor)!=null?f:"#ffffff").onChange(async c=>{this.plugin.settings.cursorColor=c,this.plugin.changeCursorColour(c),await this.plugin.saveSettings()}),n=new o.Setting(this.containerEl).setName("Blink speed (in seconds)").setDesc("The number of seconds to complete one full cursor blink cycle.");new u(n.controlEl).onClick(async()=>{T.setValue(l.blinkSpeed),await this.plugin.saveSettings()});let T=new o.SliderComponent(n.controlEl).setLimits(.2,5,.1).setDynamicTooltip().setValue((v=this.plugin.settings.blinkSpeed)!=null?v:l.blinkSpeed).onChange(async c=>{this.plugin.settings.blinkSpeed=c,await this.plugin.saveSettings()}),p=new o.Setting(this.containerEl).setName("Blink delay (in seconds)").setDesc("The number of seconds after cursor movement before blinking begins.");new u(p.controlEl).onClick(async()=>{E.setValue(l.blinkDelay),await this.plugin.saveSettings()});let E=new o.SliderComponent(p.controlEl).setLimits(0,5,.1).setDynamicTooltip().setValue((S=this.plugin.settings.blinkDelay)!=null?S:l.blinkDelay).onChange(async c=>{this.plugin.settings.blinkDelay=c,await this.plugin.saveSettings()}),g=new o.Setting(this.containerEl).setName("Smooth typing speed (in milliseconds)").setDesc("The number of milliseconds for the cursor icon to reach the true cursor location after typing or moving the cursor. 0 for instant speed.");new u(g.controlEl).onClick(async()=>{w.setValue(l.movementTime),await this.plugin.saveSettings()});let w=new o.SliderComponent(g.controlEl).setLimits(0,200,1).setDynamicTooltip().setValue((y=this.plugin.settings.movementTime)!=null?y:l.blinkDelay).onChange(async c=>{this.plugin.settings.movementTime=c,await this.plugin.saveSettings()}),C=new o.Setting(this.containerEl).setName("Cursor width (in pixels)").setDesc("The width of the cursor icon in pixels.");new u(C.controlEl).onClick(async()=>{k.setValue(l.cursorWidth),await this.plugin.saveSettings()});let k=new o.SliderComponent(C.controlEl).setLimits(1,5,1).setDynamicTooltip().setValue((b=this.plugin.settings.cursorWidth)!=null?b:l.cursorWidth).onChange(async c=>{this.plugin.settings.cursorWidth=c,await this.plugin.saveSettings()})}},u=class extends o.ButtonComponent{constructor(e){super(e);this.contentEl=e;this.setTooltip("Restore default"),this.setIcon("rotate-ccw"),this.render()}render(){this.buttonEl.classList.add("clickable-icon"),this.buttonEl.classList.add("extra-setting-button")}};var h=class extends m.Plugin{constructor(){super(...arguments);this.isInWindow=!0;this.isFirstFrame=!0;this.mouseDown=!1;this.mouseUpThisFrame=!1;this.prevCursorCoords={left:0,top:0};this.currCursorCoords={left:0,top:0};this.prevCursorPos={line:0,ch:0};this.currCursorPos={line:0,ch:0};this.prevIconCoords={left:0,top:0};this.currIconCoords={left:0,top:0};this.prevFrameTime=Date.now();this.blinkStartTime=Date.now();this.remainingMoveTime=0}changeCursorColour(e=null){e===null&&(e=!document.body.classList.contains("theme-dark")?"#000000":"#ffffff"),this.cursorElement.style.setProperty("--cursor-color",e)}blinkCursor(){let e=()=>(requestAnimationFrame(()=>{this.blinkStartTime=Date.now()}),1);if(this.prevCursorCoords.left!==this.currCursorCoords.left||this.prevCursorCoords.top!==this.currCursorCoords.top)return e();let s=Date.now()-this.blinkStartTime-this.settings.blinkDelay*1e3,n=this.settings.blinkSpeed*1e3;return s<0||s%n<n/2?1:0}checkCursorExists(e,t){if(!e||!e.focusNode||!t||!t.containerEl||!t.containerEl.className.includes("cm-focused"))return!1;let s=t.getCursor();return s?(this.currCursorPos=s,!0):!1}checkSmoothMovement(e){return this.prevIconCoords&&this.prevIconCoords.left===e.left&&this.prevIconCoords.top===e.top||this.mouseDown||this.mouseUpThisFrame?!1:((this.prevCursorPos.line!==this.currCursorPos.line||this.prevCursorPos.ch!==this.currCursorPos.ch)&&(this.remainingMoveTime=this.settings.movementTime),!0)}moveSmoothly(e,t){if(!e||this.remainingMoveTime<=0){this.remainingMoveTime=0,this.currIconCoords=this.currCursorCoords;return}let s=Math.min(t/this.remainingMoveTime,1);this.remainingMoveTime=Math.max(0,this.remainingMoveTime-t);let n={left:s*(this.currCursorCoords.left-this.prevIconCoords.left),top:s*(this.currCursorCoords.top-this.prevIconCoords.top)};this.currIconCoords={left:this.prevIconCoords.left+n.left,top:this.prevIconCoords.top+n.top}}returnReferences(){let e=activeWindow.getSelection(),t=this.app.workspace.getActiveViewOfType(m.MarkdownView),s=t?t.editor:null;return{selection:e,editor:s}}getTimeSinceLastFrame(){let e=Date.now(),t=e-this.prevFrameTime;return this.prevFrameTime=e,t}updateCurrCursorCoords(e){if(!e||!e.focusNode)return;let t=document.createRange();t.setStart(e.focusNode,e.focusOffset),e.focusOffset===0?t.setEnd(e.focusNode,1):t.setEnd(e.focusNode,e.focusOffset);let s=t.getBoundingClientRect();this.currCursorCoords={left:s.left,top:s.top},this.currCursorHeight=s.height}removeIcon(){this.cursorElement.style.display="none"}bringIconBack(){this.cursorElement.style.display="block"}updateCursor(){let e=()=>{this.mouseUpThisFrame=!1,requestAnimationFrame(this.updateCursor.bind(this))};this.timeSinceLastFrame=this.getTimeSinceLastFrame();let{selection:t,editor:s}=this.returnReferences();if(!t||!s||!this.checkCursorExists(t,s))return this.removeIcon(),e();this.bringIconBack(),this.updateCurrCursorCoords(t);let n=this.blinkCursor();return this.isFirstFrame?(this.currIconCoords=this.currCursorCoords,this.isFirstFrame=!1):this.moveSmoothly(this.checkSmoothMovement(this.currCursorCoords),this.timeSinceLastFrame),this.cursorElement.style.setProperty("--cursor-x1",`${this.currIconCoords.left}px`),this.cursorElement.style.setProperty("--cursor-y1",`${this.currIconCoords.top}px`),this.cursorElement.style.setProperty("--cursor-height",`${this.currCursorHeight}px`),this.cursorElement.style.setProperty("--cursor-width",`${this.settings.cursorWidth}px`),this.cursorElement.style.setProperty("--cursor-opacity",`${n}`),this.prevCursorCoords=this.currCursorCoords,this.prevIconCoords=this.currIconCoords,e()}async onload(){await this.loadSettings(),this.addSettingTab(new a(this.app,this)),this.cursorElement=document.body.createSpan({cls:"custom-cursor"}),this.changeCursorColour(),document.addEventListener("mousedown",()=>{this.mouseDown=!0}),document.addEventListener("mouseup",()=>{this.mouseDown=!1,this.mouseUpThisFrame=!0}),requestAnimationFrame(()=>{this.blinkStartTime=Date.now()}),this.updateCursor()}async loadSettings(){this.settings=Object.assign({},l,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
